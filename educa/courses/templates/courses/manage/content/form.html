{% extends "base.html" %}

{% block title %}
  {% if object %}
    Edit "{{ object.title }}" | Educa
  {% else %}
    Add New Content | Educa
  {% endif %}
{% endblock %}

{% block content %}
<div class="courses-container">
  <div class="courses-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-{% if object %}edit{% else %}plus-circle{% endif %}"></i>
        {% if object %}
          Edit "{{ object.title }}"
        {% else %}
          Add New Content
        {% endif %}
      </h1>
      <p class="page-subtitle">
        {% if object %}
          Update your content details
        {% else %}
          Add new educational content to your module
        {% endif %}
      </p>
    </div>
    <div class="header-actions">
      {% if module %}
      <a href="{% url 'module_content_list' module.id %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Contents</span>
      </a>
      {% endif %}
    </div>
  </div>

  <div class="auth-card module">
    <div class="module-header">
      <h2>
        <i class="fas fa-info-circle"></i>
        Content Information
      </h2>
      <p class="form-subtitle">
        {% if object %}
          Modify the content details below
        {% else %}
          Fill in the details to create new content
        {% endif %}
      </p>
    </div>
    
    <form action="" method="post" enctype="multipart/form-data" class="content-form">
      {% csrf_token %}
      
      <div class="form-group">
        {% for field in form %}
        <div class="form-field">
          <label for="{{ field.id_for_label }}" class="form-label">
            <i class="fas 
              {% if field.name == 'title' %}fa-heading
              {% elif field.name == 'content' %}fa-file-alt
              {% elif field.name in 'video,image,file' %}fa-upload
              {% elif field.name == 'order' %}fa-sort-numeric-down
              {% elif field.name == 'module' %}fa-layer-group
              {% elif field.name == 'description' %}fa-align-left
              {% else %}fa-edit{% endif %}">
            </i>
            {{ field.label }}
          </label>
          
          {% if field.field.widget.input_type == 'file' %}
          <div class="file-upload-wrapper">
            {{ field }}
            <div class="file-upload-preview" id="preview-{{ field.name }}">
              {% if object and field.value %}
              <div class="current-file">
                <i class="fas fa-file"></i>
                <span>Current: {{ field.value.name|default:field.value }}</span>
              </div>
              {% endif %}
            </div>
          </div>
          {% else %}
            {{ field }}
          {% endif %}
          
          {% if field.help_text %}
          <div class="form-help">{{ field.help_text }}</div>
          {% endif %}
          
          {% if field.errors %}
          <div class="form-errors">
            {% for error in field.errors %}
            <span class="error-message">
              <i class="fas fa-exclamation-circle"></i> {{ error }}
            </span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      
      <div class="form-actions">
        <button type="submit" class="btn btn-primary btn-submit">
          <i class="fas fa-save"></i>
          <span>Save Content</span>
        </button>
        
        {% if object %}
        <a href="{% url 'module_content_list' object.module.id %}" class="btn btn-cancel">
          <i class="fas fa-times"></i>
          <span>Cancel</span>
        </a>
        {% elif module %}
        <a href="{% url 'module_content_list' module.id %}" class="btn btn-cancel">
          <i class="fas fa-times"></i>
          <span>Cancel</span>
        </a>
        {% else %}
        <a href="{% url 'manage_course_list' %}" class="btn btn-cancel">
          <i class="fas fa-times"></i>
          <span>Cancel</span>
        </a>
        {% endif %}
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block domready %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add classes to form inputs
  const inputs = document.querySelectorAll('.content-form input:not([type="file"]):not([type="submit"]), .content-form textarea, .content-form select');
  inputs.forEach(input => {
    input.classList.add('form-control');
  });
  
  // File upload preview
  const fileInputs = document.querySelectorAll('input[type="file"]');
  fileInputs.forEach(input => {
    input.addEventListener('change', function() {
      const previewId = 'preview-' + this.name;
      const preview = document.getElementById(previewId);
      if (preview && this.files.length > 0) {
        const file = this.files[0];
        let icon = 'fa-file';
        let text = file.name;
        
        // Set appropriate icon based on file type
        if (file.type.startsWith('image/')) {
          icon = 'fa-image';
          // Create image preview
          const reader = new FileReader();
          reader.onload = function(e) {
            preview.innerHTML = `
              <div class="image-preview">
                <img src="${e.target.result}" alt="Preview" style="max-width: 200px; max-height: 150px;">
                <span>${file.name}</span>
              </div>
            `;
          };
          reader.readAsDataURL(file);
          return;
        } else if (file.type.startsWith('video/')) {
          icon = 'fa-video';
        } else if (file.type.includes('pdf')) {
          icon = 'fa-file-pdf';
        } else if (file.type.includes('word') || file.type.includes('document')) {
          icon = 'fa-file-word';
        }
        
        if (!preview.querySelector('.image-preview')) {
          preview.innerHTML = `
            <div class="file-preview">
              <i class="fas ${icon}"></i>
              <span>${text}</span>
              <small>(${(file.size / 1024).toFixed(1)} KB)</small>
            </div>
          `;
        }
      }
    });
  });
  
  // Add focus effects
  const formElements = document.querySelectorAll('.content-form input, .content-form textarea, .content-form select');
  formElements.forEach(element => {
    if (element.type !== 'file' && element.type !== 'submit') {
      element.addEventListener('focus', function() {
        this.parentElement.classList.add('focused');
      });
      
      element.addEventListener('blur', function() {
        this.parentElement.classList.remove('focused');
      });
    }
  });
  
  // Textarea auto-resize
  const textareas = document.querySelectorAll('.content-form textarea');
  textareas.forEach(textarea => {
    textarea.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = (this.scrollHeight) + 'px';
    });
    // Trigger initial resize
    textarea.dispatchEvent(new Event('input'));
  });
});
</script>
{% endblock %}